!function(e){!function(e){"use strict";var t,i,r,n,s,o,a,c,u,d,l,g,v,p=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},h=(e,t,i)=>(p(e,t,"read from private field"),i?i.call(e):t.get(e)),w=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},m=(e,t,i)=>(p(e,t,"access private method"),i);if(false){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}let f=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&i[e];if(36>r)t+=r.toString(36);else if(62>r)t+=(r-26).toString(36).toUpperCase();else if(63>r)t+="_";else t+="-"}return t};const y="_grDebugMode",b=new class{isDebugEnabled(){return!!window.sessionStorage.getItem(y)}startDebug(){window.sessionStorage.setItem(y,"true")}},S=new class{get isLoggingEnabled(){return b.isDebugEnabled()}log(...e){this.displayLog("log",...e)}info(...e){this.displayLog("info",...e)}error(...e){if(e[0]instanceof Error)e.push(e[0].stack);this.displayLog("error",...e)}warn(...e){this.displayLog("warn",...e)}displayLog(e,...t){if(this.isLoggingEnabled)console[e](...t)}};function I(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));if(t)return t[2]}function E(e,t,i=""){const r=new Date;r.setTime(r.getTime()+365*24*60*60*1e3),document.cookie=`${e}=${t}; expires=${r.toUTCString()}; path=/; ${i?`domain=${i}`:""}`}function C(e){const t=new RegExp(`[?&]${e}=([^&#]*)`).exec(window.location.href);return t?decodeURI(t[1]):null}var D=(e=>(e["SetDomain"]="setDomain",e["SetListToken"]="setListToken",e["SetUserId"]="setUserId",e["SetEvent"]="setEvent",e["SetCookie"]="setCookie",e["SetAutoFunnelData"]="setAutoFunnelData",e["Push"]="push",e["SetCustomServiceWorkerPath"]="setCustomSwPath",e["ViewItem"]="viewItem",e["ViewCategory"]="viewCategory",e["LikeItem"]="likeItem",e["UnlikeItem"]="unlikeItem",e["WishListItem"]="wishlistItem",e["Purchase"]="orderPlaced",e["CartUpdate"]="cartUpdate",e["ShopifyAbandonedCart"]="shopifyAbandonedCart",e["SaveEvent"]="saveEvent",e["FlushEvents"]="flushEvents",e["SetUserDevice"]="setUserDevice",e["SetUserLocation"]="setUserLocation",e["SetVisitUrlPath"]="setVisitUrlPath",e["SetLastActivityDate"]="setLastActivityDate",e["SetIsNewVisitor"]="setIsNewVisitor",e["SetHasUserVisitPage"]="setHasUserVisitPage",e["SetRawEvent"]="setRawEvent",e["ImportScript"]="importScript",e["DelayScript"]="delayScript",e["InitScript"]="initScript",e))(D||{}),P=(e=>(e["UserEventSaved"]="userEventSaved",e["WebPushConsentAccepted"]="webPushConsentAccepted",e["WebPushCustomConsentRejected"]="webPushCustomConsentRejected",e["WebPushNativeConsentRejected"]="webPushNativeConsentRejected",e))(P||{});const T=10;class V{constructor(){this._cvar=[]}setTrackerUrl(e){this.trackerUrl=e}markAsEnabled(e){this.isEnabled=e}setUserId(e){this.uid=e}setCustomVariable(e,t,i){if(!this._cvar[e])this._cvar[e]=[];this._cvar[e].push(t),this._cvar[e].push(i)}setGenerationTime(){var e;if(this.gt_ms)return;const t=null==(e=performance.getEntriesByType("navigation")[0])?void 0:e.toJSON();if(t)this.gt_ms=Math.floor(t.responseEnd-t.requestStart)}trackEvent(e,t,i,r){this.trackPageView(Object.assign({e_c:e,e_a:t,e_n:i,...r&&{e_v:r}}))}getCustomVariable(){return JSON.stringify(Object.assign({},this._cvar))}static getScreenResolution(){return`${screen.width??T}x${screen.height??T}`}static encodeUrlParam(e){return`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`}getFullTrackerUrl(e){const t=new Date;return Object.entries({...e,...document.referrer&&{urlRef:document.referrer},url:window.location.href,uid:this.uid,_cvar:this.getCustomVariable(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),res:V.getScreenResolution(),gt_ms:this.gt_ms}).reduce(((e,t)=>void 0===t[1]?e:`${e}&${V.encodeUrlParam(t)}`),this.trackerUrl)}trackPageView(e){if(e||this.isEnabled)if(this.setGenerationTime(),window.fetch)fetch(this.getFullTrackerUrl(e),{method:"GET",mode:"no-cors"}).catch((e=>{S.error("Error while sending tracking data:",e)}));else new Image(1,1).src=this.getFullTrackerUrl(e)}}var _=(e=>(e["UuidHasBeenSet"]="grUuidHasBeenSet",e["PopupsRendererCustomUrl"]="grPopupsRendererCustomUrl",e))(_||{});class k{constructor(){w(this,t,new Proxy({},{get(e,t){if(t in e)return e[t];else return e[t]=[],e[t]}}))}addEvent(e,i){h(this,t)[e].push(i)}drainEvents(e){const i=h(this,t)[e];return h(this,t)[e]=[],i}getEvents(e){return h(this,t)[e]}hasDelayedEvents(e){return h(this,t)[e].length>0}}t=new WeakMap,i=new WeakMap,r=new WeakMap;const U=new class{constructor(){w(this,i,{}),w(this,r,new k)}publish(e,...t){var n;if(null==(n=h(this,i)[e])?void 0:n.length)h(this,i)[e].forEach((i=>{i(...t),S.log(`Event ${e} published with arguments'`,...t)}));else h(this,r).addEvent(e,t)}subscribe(e,t,n={}){const{preventEventDraining:s,ignoreQueuedEvents:o}=n;if(!h(this,i)[e])h(this,i)[e]=[];if(h(this,r).hasDelayedEvents(e)&&!o)if(s)h(this,r).getEvents(e).forEach((e=>t(...e)));else h(this,r).drainEvents(e).forEach((e=>t(...e)));h(this,i)[e].push(t)}unsubscribe(e,t){var r;const n=null==(r=h(this,i)[e])?void 0:r.indexOf(t);if(n>-1)h(this,i)[e].splice(n,1)}removeListeners(e){delete h(this,i)[e]}};var A,L,x=(e=>(e["DeviceType"]="debug_device_type",e["Location"]="debug_location",e["VisitUrlPath"]="debug_visit_url_path",e["BrowserStorageLastActivityDate"]="debug_browser_storage_last_activity_date",e["NewVisitor"]="debug_new_visitor",e["HasUserVisitPage"]="debug_has_user_visit_page",e["Events"]="debug_events",e))(x||{});function O(){const e=e=>{const t=sessionStorage.getItem(e);if(t){if([x.DeviceType,x.VisitUrlPath,x.Location].includes(e))return t;if(e===x.BrowserStorageLastActivityDate){const e=new Date(t);return isNaN(e.getTime())?void 0:e}if([x.NewVisitor,x.HasUserVisitPage,x.Events].includes(e))try{return JSON.parse(t)}catch(i){S.error(`Invalid debug data for: ${e}`)}}};return{enabled:true,data:{[x.DeviceType]:e(x.DeviceType),[x.BrowserStorageLastActivityDate]:e(x.BrowserStorageLastActivityDate),[x.Location]:e(x.Location),[x.NewVisitor]:e(x.NewVisitor),[x.VisitUrlPath]:e(x.VisitUrlPath),[x.HasUserVisitPage]:e(x.HasUserVisitPage),[x.Events]:e(x.Events)}}}function N(e,t,i){const r=Z.debugObject;Z.debugObject={...r,data:{...null==r?void 0:r.data,[e]:t}},sessionStorage.setItem(e,i||String(t))}function B(e){var t,i;return null==(i=null==(t=Z.debugObject)?void 0:t.data)?void 0:i[e]}function R(e,t){return Z.isDebug?t:e}(L=A||(A={}))["PageVisit"]="visit",L["Popup"]="popup",L["ViewItem"]="view_item",L["ViewCategory"]="view_category",L["WishlistItem"]="wishlist_item",L["LikeItem"]="like_item",L["UnlikeItem"]="unlike_item",L["OrderPlaced"]="order_placed",L["Cart"]="cart_update",void(L["ShopifyAbandonedCart"]="shopify_webhook_abandoned_cart");let W=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}};class $ extends W{constructor(e){super(e)}}const j={cartToken:"string",urlToken:"string",visitorEmail:"string"},F=["cartToken","urlToken"];var M,J,z,q,G,H,K,X,Y;(Y=M||(M={}))["Inline"]="inline",void(Y["Popup"]="popup"),(X=J||(J={}))["Hq"]="Hq",void(X["Us"]="Us"),void((z||(z={}))["UserAid"]="X-Aid"),(K=q||(q={}))["Active"]="active",void(K["Inactive"]="inactive"),(H=G||(G={}))["ReactSendWebPush"]="react_web_webpush",H["ReactCollectWebPushConsent"]="react_web_collect_webpush_subscription",H["FilterWebUrl"]="filter_web_url",H["FilterWebSubscribers"]="filter_web_subscriber",H["FilterLocation"]="filter_web_geolocation",H["ConditionProductViewed"]="await_web_view_item_event",H["ConditionCategoryViewed"]="await_web_view_category_event",H["ConditionWebPushConsent"]="await_web_webpush_subscribe",H["TransferToBackend"]="react_backend_transfer",H["AwaitScroll"]="await_scroll",void(H["ShowPopup"]="react_popup"),n=new WeakMap;const Q=new class{constructor(){w(this,n,{[A.LikeItem]:[],[A.OrderPlaced]:[],[A.UnlikeItem]:[],[A.ViewCategory]:[],[A.ViewItem]:[],[A.WishlistItem]:[],[A.PageVisit]:[],[A.Popup]:[],[A.Cart]:[]})}getEvents(e){return Promise.resolve(h(this,n)[e])}getAllEvents(){return Promise.resolve(Object.values(h(this,n)).flat(1))}getAllECommerceEvents(){return Promise.resolve([...h(this,n)[A.ViewItem],...h(this,n)[A.ViewCategory],...h(this,n)[A.LikeItem],...h(this,n)[A.UnlikeItem],...h(this,n)[A.WishlistItem],...h(this,n)[A.OrderPlaced],...h(this,n)[A.Cart]])}getAllPopupEvents(){return Promise.resolve([...h(this,n)[A.Popup]])}saveEvent(e){return h(this,n)[e.eventType].push(e),Promise.resolve()}},Z=new class{initialize(e){const{xsid:t,grid:i,clientLatestGrid:r,domain:n,aid:s,useNOStorage:o,useBetterSubscriberIdentification:a,isServedFromCustomDomain:c,scriptsDomain:u,scriptsVersion:d,tracking:l,isDebugMode:g}=e;if(g)b.startDebug();window.__grIntegrationConfig=window.__grIntegrationConfig||{cData:{aid:s,grid:i,domain:n,useNOStorage:o,useBetterSubscriberIdentification:a,isServedFromCustomDomain:c,clientLatestGrid:r},visitor:{email:null,eComId:null,xsid:t},tracking:{isEnabled:l},webEvents:{isModuleInitialized:false,visitorApplicationEndpoint:null,automationJourneyGraphs:[]},webPush:{isModuleInitialized:false,customSwPath:null,wpid:null,pushDomain:null,promptEndpoint:null},analyticsData:{scriptsDomain:u,scriptsVersion:d},ecommerce:{},eventBus:U,temporaryEventsStorage:Q,debug:g?O():void 0,delayedScripts:{}}}isWebEventModuleInitialized(){return window.__grIntegrationConfig.webEvents.isModuleInitialized??false}setWebEventModuleInitialized(){if(false===window.__grIntegrationConfig.webEvents.isModuleInitialized)window.__grIntegrationConfig.webEvents.isModuleInitialized=true}isWebPushModuleInitialized(){var e,t;return(null==(t=null==(e=window.__grIntegrationConfig)?void 0:e.webPush)?void 0:t.isModuleInitialized)??false}setWebPushModuleInitialized(){var e,t;if(false===(null==(t=null==(e=window.__grIntegrationConfig)?void 0:e.webPush)?void 0:t.isModuleInitialized))window.__grIntegrationConfig.webPush.isModuleInitialized=true}canUseBackendForSubscriberIdentification(){return window.__grIntegrationConfig.cData.useBetterSubscriberIdentification}getUserAid(){return window.__grIntegrationConfig.cData.aid}getClientLatestGrid(){return window.__grIntegrationConfig.cData.clientLatestGrid}getUserAnalyticsDomain(){return window.__grIntegrationConfig.cData.domain}enablePopupDevMode(){window.__grIntegrationConfig.setCustomPopupRendererUrl=e=>{window.sessionStorage.setItem(_.PopupsRendererCustomUrl,e)}}getPopupRendererCustomUrl(){return window.sessionStorage.getItem(_.PopupsRendererCustomUrl)}setCustomSwPath(e){if("string"!=typeof e)throw new Error("Path type must be string");if(!e.match(/gr_sw_main.js$/))throw new Error("Invalid sw file name");window.__grIntegrationConfig.webPush.customSwPath=e}getCustomSwPath(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.webPush.customSwPath}isTrackingEnabled(){return window.__grIntegrationConfig.tracking.isEnabled}isTrackingScriptServedFromCustomDomain(){return window.__grIntegrationConfig.cData.isServedFromCustomDomain}set visitorEmail(e){window.__grIntegrationConfig.visitor.email=e}get visitorEmail(){return window.__grIntegrationConfig.visitor.email}get pushWpid(){return window.__grIntegrationConfig.webPush.wpid}set pushWpid(e){window.__grIntegrationConfig.webPush.wpid=e}set pushDomain(e){window.__grIntegrationConfig.webPush.pushDomain=e}get pushDomain(){return window.__grIntegrationConfig.webPush.pushDomain}set pushPromptEndpoint(e){window.__grIntegrationConfig.webPush.promptEndpoint=e}get pushPromptEndpoint(){return window.__grIntegrationConfig.webPush.promptEndpoint}get eventBus(){return window.__grIntegrationConfig.eventBus}get canUseBackendStorageForEvents(){return window.__grIntegrationConfig.cData.useNOStorage}get webConnectScriptCdnUrl(){return window.__grIntegrationConfig.analyticsData.scriptsDomain}get webConnectCurrentScriptsVersion(){return window.__grIntegrationConfig.analyticsData.scriptsVersion}get isDebug(){var e,t;return!!(null==(t=null==(e=window.__grIntegrationConfig)?void 0:e.debug)?void 0:t.enabled)}set debugObject(e){window.__grIntegrationConfig.debug=e}get debugObject(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.debug}get delayedScripts(){var e;return(null==(e=window.__grIntegrationConfig)?void 0:e.delayedScripts)||{}}set delayedScripts(e){window.__grIntegrationConfig.delayedScripts=e}set visitorApplicationEndpoint(e){window.__grIntegrationConfig.webEvents.visitorApplicationEndpoint=e}get visitorApplicationEndpoint(){return window.__grIntegrationConfig.webEvents.visitorApplicationEndpoint}get webEventsSearchApplicationEndpoint(){return window.__grIntegrationConfig.ecommerce.webEventsSearchApplicationEndpoint}set webEventsSearchApplicationEndpoint(e){window.__grIntegrationConfig.ecommerce.webEventsSearchApplicationEndpoint=e}get temporaryEventsStorage(){return window.__grIntegrationConfig.temporaryEventsStorage}get automationJourneyGraphs(){return window.__grIntegrationConfig.webEvents.automationJourneyGraphs}get visitorXsid(){return window.__grIntegrationConfig.visitor.xsid}},ee=204,te=new class{retrieveXsid(){return((e,t)=>{const i=e.isTextResponse??(null==t?void 0:t.isTextResponse);return fetch(e,{...t,headers:{...null==t?void 0:t.headers,...(null==t?void 0:t.omitAidHeader)?{}:{[z.UserAid]:Z.getUserAid()}}}).then((async e=>{if(e.ok){if(e.status===ee)return;return i?e.text():e.json()}const t=await e.text();return Promise.reject({statusCode:e.status,message:t})}))})(new URL("retrieveXsid",Z.getUserAnalyticsDomain()).href,{isTextResponse:true,omitAidHeader:true,credentials:"include"})}};var ie=(e=>(e["v2"]="v2",e["af"]="af",e["wp"]="wp",e["we"]="we",e["ec"]="ec",e))(ie||{}),re=(e=>(e["v2"]="GRV2",e["af"]="GRAF",e["wp"]="GRWP",e["we"]="GRWE",e["ec"]="GREC",e))(re||{});const ne=new Map,se=(e,t)=>{if(!Array.isArray(e))switch(typeof e){case"string":e=[e];break;case"undefined":e=[];break;default:throw new TypeError(`Expected '${t}' to be a string or an array, but got a type of '${typeof e}'`)}return e.filter((e=>{if("string"!=typeof e){if(void 0===e)return false;throw new TypeError(`Expected '${t}' to be an array of strings, but found a type of '${typeof e}' in the array`)}return true}))};function oe(e,t,i){return((e,t,i,r)=>{if(e=se(e,"inputs"),0===(t=se(t,"patterns")).length)return[];t=t.map((e=>((e,t)=>{t={caseSensitive:false,...t};const i=e+JSON.stringify(t);if(ne.has(i))return ne.get(i);const r="!"===e[0];if(r)e=e.slice(1);e=(e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e).replace(/\\\*/g,"[\\s\\S]*");const n=new RegExp(`^${e}$`,t.caseSensitive?"":"i");return n.negated=r,ne.set(i,n),n})(e,i)));const{allPatterns:n}=i||{},s=[];for(const o of e){let e;const i=[...t].fill(false);for(const[r,n]of t.entries())if(n.test(o))if(i[r]=true,e=!n.negated,!e)break;if(!(false===e||void 0===e&&t.some((e=>!e.negated))||n&&i.some(((e,i)=>!e&&!t[i].negated))))if(s.push(o),r)break}return s})(e,t,i,true).length>0}var ae,ce,ue,de,le,ge,ve,pe,he,we,me,fe,ye,be,Se,Ie,Ee,Ce,De,Pe,Te,Ve,_e,ke,Ue,Ae,Le,xe,Oe,Ne,Be,Re,We,$e,je,Fe,Me,Je,ze,qe;(qe=ae||(ae={}))["ShowWhenCondition"]="showWhenCondition",qe["VisitorsCondition"]="visitors",qe["DeviceCondition"]="device",qe["LocationCondition"]="location",qe["ECommerceCondition"]="ecommerce",qe["TriggerFrequency"]="frequency",qe["PreventDisplay"]="preventDisplay",void(qe["DateRange"]="dateRange"),(ze=ce||(ce={}))["Mobile"]="mobile",ze["Tablet"]="tablet",void(ze["Desktop"]="desktop"),(Je=ue||(ue={}))["All"]="all",Je["New"]="new",void(Je["Returning"]="returning"),void((de||(de={}))["All"]="all"),(Me=le||(le={}))["ConditionsLogicSeparator"]="conditionsLogicSeparator",void(Me["ECommerceConditions"]="ecommerceConditions"),(Fe=ge||(ge={}))["Amount"]="amount",void(Fe["Date"]="date"),(je=ve||(ve={}))["And"]="and",void(je["Or"]="or"),($e=pe||(pe={}))["Exactly"]="exactly",$e["LessThan"]="lessThan",void($e["MoreThan"]="moreThan"),(We=he||(he={}))["LastDays"]="lastDays",void(We["DateRange"]="dateRange"),(Re=we||(we={}))["AnyProduct"]="any",Re["AnyCategory"]="any",Re["AnyProductLiked"]="any",Re["AnyProductInPlacedOrder"]="any",Re["AnyCategoryInPlacedOrder"]="any",Re["AnyProductInUpdatedCart"]="any",void(Re["AnyCategoryInUpdatedCart"]="any"),(Be=me||(me={}))["PastEvents"]="filter",void(Be["FutureEvents"]="await"),(Ne=fe||(fe={}))["Category"]="category",void(Ne["Product"]="product"),void((ye||(ye={}))["Product"]="product"),(Oe=be||(be={}))["ViewProductOrCategory"]="productOrCategoryView",Oe["LikeProduct"]="likeItem",Oe["OrderPlaced"]="orderPlaced",void(Oe["CartUpdated"]="cartUpdated"),(xe=Se||(Se={}))["Percent"]="percent",void(xe["Selector"]="selector"),(Le=Ie||(Ie={}))["Instantly"]="instantly",Le["Delay"]="delay",Le["Exit"]="exit",Le["Scroll"]="scroll",void(Le["Inactivity"]="inactivity"),(Ae=Ee||(Ee={}))["AfterSubmit"]="submit",Ae["AfterClose"]="close",void(Ae["AfterTimes"]="timesAmount"),(Ue=Ce||(Ce={}))["Always"]="always",Ue["Session"]="session",void(Ue["EveryDays"]="everyDays"),(ke=De||(De={}))["Exactly"]="equal",ke["LessThan"]="lessThan",void(ke["MoreThan"]="moreThan"),(_e=Pe||(Pe={}))["Exactly"]="equal",_e["LessThan"]="lessThan",void(_e["MoreThan"]="moreThan"),(Ve=Te||(Te={}))[Ve["InvalidCssSelector"]=1]="InvalidCssSelector",Ve[Ve["EmptyCssSelector"]=2]="EmptyCssSelector",Ve[Ve["CssSelectorTooLong"]=3]="CssSelectorTooLong",Ve[Ve["CssInvalidType"]=4]="CssInvalidType",Ve[Ve["InvalidTimeoutProperty"]=5]="InvalidTimeoutProperty",Ve[Ve["ShowWhenScrollPercentInvalidValueType"]=6]="ShowWhenScrollPercentInvalidValueType",Ve[Ve["ShowWhenScrollPercentValueOutOfBound"]=7]="ShowWhenScrollPercentValueOutOfBound",Ve[Ve["VisitorTriggerEmpty"]=8]="VisitorTriggerEmpty",Ve[Ve["VisitorTriggerInvalidProperty"]=9]="VisitorTriggerInvalidProperty",Ve[Ve["DevicesTriggerEmpty"]=10]="DevicesTriggerEmpty",Ve[Ve["DevicesTriggerInvalidValue"]=11]="DevicesTriggerInvalidValue",Ve[Ve["FrequencyEmptyTrigger"]=12]="FrequencyEmptyTrigger",Ve[Ve["FrequencyTriggerInvalidName"]=13]="FrequencyTriggerInvalidName",Ve[Ve["FrequencyTriggerNDaysInvalidPropertyValue"]=14]="FrequencyTriggerNDaysInvalidPropertyValue",Ve[Ve["FrequencyTriggerNDaysEmptyValue"]=15]="FrequencyTriggerNDaysEmptyValue",Ve[Ve["PreventDisplayTriggerInvalidName"]=16]="PreventDisplayTriggerInvalidName",Ve[Ve["PreventDisplayTriggerAfterTimesNoValue"]=17]="PreventDisplayTriggerAfterTimesNoValue",Ve[Ve["PreventDisplayTriggerAfterTimesInvalidValue"]=18]="PreventDisplayTriggerAfterTimesInvalidValue",Ve[Ve["DateRangeInvalidFromDate"]=19]="DateRangeInvalidFromDate",Ve[Ve["DateRangeInvalidToDate"]=20]="DateRangeInvalidToDate",Ve[Ve["DateRangeDateFromAfterDateTo"]=21]="DateRangeDateFromAfterDateTo",Ve[Ve["DateRangeToBeforeCurrentTime"]=22]="DateRangeToBeforeCurrentTime",Ve[Ve["LocationEmptyTrigger"]=23]="LocationEmptyTrigger",Ve[Ve["LocationInvalidType"]=24]="LocationInvalidType",Ve[Ve["LackOfLogicSeparator"]=25]="LackOfLogicSeparator",Ve[Ve["LackOfTriggerConditions"]=26]="LackOfTriggerConditions",Ve[Ve["InvalidTriggerConditions"]=27]="InvalidTriggerConditions",Ve[Ve["NoProductOrCategorySelected"]=28]="NoProductOrCategorySelected",Ve[Ve["ProductInvalidType"]=29]="ProductInvalidType",Ve[Ve["CategoryInvalidType"]=30]="CategoryInvalidType",Ve[Ve["AmountInvalidConditionName"]=31]="AmountInvalidConditionName",Ve[Ve["AmountInvalidConditionValueType"]=32]="AmountInvalidConditionValueType",Ve[Ve["DateInvalidConditionName"]=33]="DateInvalidConditionName",Ve[Ve["DateLastDaysInvalidConditionValue"]=34]="DateLastDaysInvalidConditionValue",Ve[Ve["DateDateRangeInvalidConditionValue"]=35]="DateDateRangeInvalidConditionValue",Ve[Ve["DateDateRangeFromInvalidValue"]=36]="DateDateRangeFromInvalidValue",Ve[Ve["DateDateRangeToInvalidValue"]=37]="DateDateRangeToInvalidValue",Ve[Ve["DateDateRangeDateFromAfterDateTo"]=38]="DateDateRangeDateFromAfterDateTo",Ve[Ve["PopupTriggerInvalidName"]=39]="PopupTriggerInvalidName",Ve[Ve["PopupTriggerLackOfValuesInLikeItemTrigger"]=40]="PopupTriggerLackOfValuesInLikeItemTrigger",Ve[Ve["PopupTriggerLikeItemInvalidValues"]=41]="PopupTriggerLikeItemInvalidValues",Ve[Ve["PopupTriggerOrderPlacedNoConditions"]=42]="PopupTriggerOrderPlacedNoConditions",Ve[Ve["PopupTriggerOrderPlacedInvalidProducts"]=43]="PopupTriggerOrderPlacedInvalidProducts",Ve[Ve["PopupTriggerOrderPlacedInvalidCategories"]=44]="PopupTriggerOrderPlacedInvalidCategories",Ve[Ve["PopupTriggerCartUpdatedNoConditions"]=45]="PopupTriggerCartUpdatedNoConditions",Ve[Ve["PopupTriggerCartUpdatedInvalidProducts"]=46]="PopupTriggerCartUpdatedInvalidProducts",Ve[Ve["PopupTriggerCartUpdatedInvalidCategories"]=47]="PopupTriggerCartUpdatedInvalidCategories",Ve[Ve["PopupTriggerPriceValueConditionInvalidComparator"]=48]="PopupTriggerPriceValueConditionInvalidComparator",Ve[Ve["PopupTriggerPriceValueConditionInvalidValue"]=49]="PopupTriggerPriceValueConditionInvalidValue",Ve[Ve["PopupTriggerProductsAmountValueConditionInvalidComparator"]=50]="PopupTriggerProductsAmountValueConditionInvalidComparator",Ve[Ve["PopupTriggerProductsAmountValueConditionInvalidValue"]=51]="PopupTriggerProductsAmountValueConditionInvalidValue",void(Ve[Ve["PopupTriggerInvalidTriggerType"]=52]="PopupTriggerInvalidTriggerType");class Ge extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}}class He extends Ge{constructor(){super("Failed to parse data from JSON string")}}var Ke=(e=>(e["visitorUuid"]="gaVisitorUuid",e["visitorValuable"]="gaIsValuable",e["VisitorResubscribed"]="gaVisitorResubscribed",e["NotificationConsentStatus"]="gaNotificationConsent",e["NotificationConsentAcceptedFromPrompt"]="gaWpnConAcc",e["NotificationConsentCustomPromptRejectedDEPRECATED"]="gaWpnConRej-{promptId}",e["NotificationConsentCustomPromptRejected"]="gaWpnConRej-promptId",e))(Ke||{}),Xe=(e=>(e["Show"]="show",e["Close"]="close",e["Submit"]="submit",e))(Xe||{}),Ye=(e=>(e["One"]="1.0",e))(Ye||{}),Qe=(e=>(e["Web"]="web",e["Mobile"]="mobile",e))(Qe||{});const Ze=new class{constructor(){this.timer=Date.now()}getCurrentVisitOnPageTime(){return Date.now()-this.timer}};var et=(e=>(e[e["Mobile"]=480]="Mobile",e[e["Tablet"]=768]="Tablet",e))(et||{});const tt=Symbol("DeviceService");class it{constructor(e){if(new.target===it&&e!==tt)throw new Error(`Invalid ${new.target.name} constructor`)}detectDeviceTypeByScreenWidth(e){var t;const{availWidth:i,availHeight:r}=screen;let n=null==(t=screen.orientation)?void 0:t.type;if(!n)n=window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait";const s=n.match(/landscape/)?r:i;if(et.Mobile>=s)return ce.Mobile;else if(s>et.Mobile&&et.Tablet>=s)return ce.Tablet;return e?ce.Tablet:ce.Desktop}getDeviceType(){const{userAgentData:e}=window.navigator;if(e){const{mobile:t}=e;if(t)return this.detectDeviceTypeByScreenWidth(true);else return ce.Desktop}return this.detectDeviceTypeByScreenWidth()}getBrowserLanguage(){const{language:e}=window.navigator;if(e.match(/\w{2}-\w{2}/))return e.split("-")[0].toUpperCase();else return e.toLowerCase()}getUserOs(){const{userAgentData:e}=window.navigator;if(e)return e.platform.toLowerCase();else return this.getOsFromUserAgent()}getOsFromUserAgent(){let e="unknown";const{userAgent:t}=navigator,i=t.toLowerCase();if(i.includes("win"))e="windows";if(i.includes("mac"))e="macos";if(i.includes("x11"))e="unix";if(i.includes("linux"))e="Linux";if(i.includes("android"))e="android";if(/iphone|ipad|ipod/.test(i))e="ios";return e}}const rt=new it(tt);class nt{constructor(e){this.eventType=e,this.eventId=null,this.aid=Z.getUserAid(),this.grid=Z.getClientLatestGrid(),this.time=Ze.getCurrentVisitOnPageTime(),this.uuid=I(Ke.visitorUuid),this.url=window.location.href,this.occurredOn=new Date,this.tags=[]}get externalUid(){const{xsid:e,email:t,eComId:i}=window.__grIntegrationConfig.visitor;return i||e||t}toJSON(){return{eventId:this.eventId,aid:this.aid,grid:this.aid,uuid:this.uuid,externalUid:this.externalUid,time:this.time,url:this.url,tags:this.tags,eventType:this.eventType,occurredOn:this.occurredOn.toUTCString()}}toString({normalized:e}={}){if(e)return JSON.stringify(this.normalizeForExternalStorage());else return JSON.stringify(this.toJSON())}normalize(){const{eventId:e,...t}=this.toJSON();return t}getBaseNormalizedEvent(){return{version:Ye.One,grid:this.grid,aid:this.aid,time:this.time,tags:this.tags,occurred_on:this.occurredOn.toISOString(),url:this.url,app:{lang:rt.getBrowserLanguage(),device:rt.getDeviceType(),os:rt.getUserOs()},channel:Qe.Web,visitor:{uuid:this.uuid,external_id:this.externalUid,xsid:Z.visitorXsid}}}}class st extends nt{constructor(e,t){super(A.Popup),this.popupEvent=e,this.popupId=t}toJSON(){return{...super.toJSON(),popupId:this.popupId,popupEvent:this.popupEvent}}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:"1.0",name:A.Popup}}}}class ot extends nt{toJSON(){return{...super.toJSON(),data:this.data}}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:this.eventVersion,name:this.eventType,data:this.data}}}}class at extends nt{constructor(e){super(A.ShopifyAbandonedCart),this.data=e}toJSON(){return{...super.toJSON(),data:this.data}}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:"1.0",name:A.ShopifyAbandonedCart,data:this.data}}}}const ct=class e{constructor(e){var t,i,r;w(this,s,void 0),i=e,p(this,t=s,"write to private field"),r?r.call(this,i):t.set(this,i),i}static create(t){return new e(t)}validate(e){return Object.entries(h(this,s)).reduce(((t,[i,r])=>{if(false===t)return t;if(null==e[i]&&r._isOptional)return t;else return r.call(e,e[i])}),true)}stringifySchemaShape(){var t;return m(t=e,o,a).call(t,h(this,s))}trim(e,t=h(this,s)){var i;const r={};for(const[n,s]of Object.entries(e))if("object"==typeof s&&null!==s){if(n in t){const e=null==(i=t[n])?void 0:i.valueShape;if(Array.isArray(s))if(e)r[n]=s.map((t=>this.trim(t,e)));else r[n]=s;else r[n]=this.trim(s,e)}}else if(n in t)r[n]=s;return r}static string(){return dt((e=>"string"==typeof e),(()=>"string"))}static number(){return dt((e=>"number"==typeof e),(()=>"number"))}static boolean(){return dt((e=>"boolean"==typeof e),(()=>"boolean"))}static dateString(){return dt((e=>{if("string"!=typeof e)return false;else return!Number.isNaN(new Date(e).getTime())}),(()=>"date string"))}static object(t){return dt((i=>{if(!t||"object"!=typeof t)return false;else return e.create(t).validate(i)}),(()=>m(this,o,a).call(this,t)),t)}static array(t){return dt((i=>{if(!Array.isArray(i))return false;if("function"==typeof t)return i.every((e=>t(e)));const r=e.create(t);return i.every((e=>r.validate(e)))}),(()=>`[${m(this,o,a).call(this,t)}]`),"function"==typeof t?void 0:t)}};s=new WeakMap,o=new WeakSet,a=e=>{const t={};if("function"==typeof e)return e.getValueType();else for(const[i,r]of Object.entries(e))t[i]=r.getValueType();try{return JSON.stringify(t).replaceAll('\\"','"')}catch{return"Failed to parse validation shape"}},w(ct,o);let ut=ct;function dt(e,t,i){if(e.optional=()=>(e._isOptional=true,e),e.getValueType=t,i)e.valueShape=i;return e}const lt={id:ut.string(),sku:ut.string().optional(),name:ut.string().optional(),vendor:ut.string().optional(),price:ut.string().optional(),currency:ut.string().optional()},gt=ut.array({id:ut.string(),name:ut.string().optional()}).optional(),vt={id:ut.string()},pt={shop:ut.object({...vt}).optional(),product:ut.object({...lt}),categories:gt},ht={product:ut.object({...lt}),categories:gt,quantity:ut.number()},wt=ut.create({...pt}),mt=ut.create({shop:ut.object({...vt}).optional(),id:ut.string(),name:ut.string().optional()}),ft=ut.create({...pt}),yt=ut.create({...pt}),bt=ut.create({...pt}),St=ut.create({orderId:ut.string(),cartId:ut.string().optional(),price:ut.number(),currency:ut.string(),products:ut.array(ht)}),It=ut.create({price:ut.number(),cartId:ut.string(),cartUrl:ut.string(),currency:ut.string(),products:ut.array(ht)});class Et extends Error{constructor(e){super(`Data doesn't match required schema: ${e}`)}}class Ct extends nt{constructor(){super(A.PageVisit)}normalizeForExternalStorage(){return{...this.getBaseNormalizedEvent(),event:{version:"1.0",name:this.eventType}}}}const Dt={[A.ViewItem]:wt,[A.ViewCategory]:mt,[A.WishlistItem]:ft,[A.LikeItem]:yt,[A.UnlikeItem]:bt,[A.OrderPlaced]:St,[A.Cart]:It},Pt={[A.ViewItem]:class extends ot{constructor(e){super(A.ViewItem),this.data=e,this.eventVersion="1.0"}},[A.ViewCategory]:class extends ot{constructor(e){super(A.ViewCategory),this.data=e,this.eventVersion="1.0"}},[A.WishlistItem]:class extends ot{constructor(e){super(A.WishlistItem),this.data=e,this.eventVersion="1.0"}},[A.LikeItem]:class extends ot{constructor(e){super(A.LikeItem),this.data=e,this.eventVersion="1.0"}},[A.UnlikeItem]:class extends ot{constructor(e){super(A.UnlikeItem),this.data=e,this.eventVersion="1.0"}},[A.OrderPlaced]:class extends ot{constructor(e){super(A.OrderPlaced),this.data=e,this.eventVersion="1.0"}},[A.Cart]:class extends ot{constructor(e){super(A.Cart),this.data=e,this.eventVersion="1.0"}}},Tt=class e{static getPageVisitEvent(){return new Ct}static getPopupEvent({popupId:e,popupEventName:t}){return new st(t,e)}static getPopupSubmitEvent(e){return new st(Xe.Submit,e)}static getPopupShowEvent(e){return new st(Xe.Show,e)}static getPopupCloseEvent(e){return new st(Xe.Close,e)}static getViewItemEvent(t){var i;return m(i=e,c,u).call(i,A.ViewItem,t)}static getWishlistItemEvent(t){var i;return m(i=e,c,u).call(i,A.WishlistItem,t)}static getLikeItemEvent(t){var i;return m(i=e,c,u).call(i,A.LikeItem,t)}static getUnlikeItemEvent(t){var i;return m(i=e,c,u).call(i,A.UnlikeItem,t)}static getViewCategoryEvent(t){var i;return m(i=e,c,u).call(i,A.ViewCategory,t)}static getOrderPlacedEvent(t){var i;return m(i=e,c,u).call(i,A.OrderPlaced,t)}static getCartUpdateEvent(t){var i;return m(i=e,c,u).call(i,A.Cart,t)}static getShopifyIntegrationAbandonedCartEvent(e){try{return(e=>{if("object"!=typeof e||null===e)throw new $("Invalid data parameter type");else{const t=Object.entries(j),i=Object.keys(e);if(!F.every((e=>i.includes(e))))throw new $("Lack of required parameters");if(!t.every((([t,i])=>!e[t]||typeof e[t]===i)))throw new $("Properties have invalid type")}return true})(e),new at((t=e,i=Object.keys(j),Object.entries(t).reduce(((e,[t,r])=>{if(i.includes(t))e[t]=r;return e}),{})))}catch(r){return S.error(r),null}var t,i}};c=new WeakSet,u=(e,t)=>{const i=Dt[e],r=Pt[e];if(!i||!r)throw new Error("Event type not supported in event factory");if(!i.validate(t))throw new Et(i.stringifySchemaShape());return new r(i.trim(t))},w(Tt,c);let Vt=Tt;const _t=Symbol("StorageService");class kt{constructor(e){if(new.target===kt&&e!==_t)throw new Error(`Invalid ${new.target.name} constructor`)}async isNewVisitor(){return!(await this.getLastActivityDate())}getLastActivityDate(){return this.getLastActivityDateFromBrowserStorage()}getLastActivityDateFromBrowserStorage(){var e;const t=I(Ke.visitorUuid),i=localStorage.getItem("gaLocalStorageVisitKey");let r;try{r=JSON.parse(i)}catch{throw new He}if(null==r?void 0:r[t])return Promise.resolve(new Date(null==(e=r[t])?void 0:e.lastActivity));else return null}saveUserActivity(){Z.eventBus.publish(D.SaveEvent,{sendToBackend:true,saveToLocal:false},A.PageVisit,null),this.saveUserActivityToBrowserStorage()}saveUserActivityToBrowserStorage(){const e={[I(Ke.visitorUuid)]:{lastActivity:Vt.getPageVisitEvent().occurredOn.toUTCString()}};try{window.localStorage.setItem("gaLocalStorageVisitKey",JSON.stringify(e))}catch{throw new He}}}const Ut=new kt(_t),At=Symbol("DebugStorageService");class Lt extends kt{constructor(e){if(super(),new.target===Lt&&e!==At)throw new Error(`Invalid ${new.target.name} constructor`)}getLastActivityDate(){var e;const t=B(x.BrowserStorageLastActivityDate);if(isNaN(null==(e=null==t?void 0:t.getTime)?void 0:e.call(t)))return super.getLastActivityDate();else return Promise.resolve(t)}setLastActivityDate(e){const t=new Date(e);if(isNaN(t.getTime()))return S.error("Incorrect dateString for last activity date. Try again with isoString."),null;N(x.BrowserStorageLastActivityDate,t,t.toISOString())}isNewVisitor(){const e=B(x.NewVisitor);if(void 0===e)return super.isNewVisitor();else return Promise.resolve(e)}setIsNewVisitor(e){N(x.NewVisitor,e,String(e))}}const xt=new Lt(At);function Ot(){return R(Ut,xt)}var Nt=(e=>(e["Always"]="always",e["OnceEveryDays"]="xDays",e["Session"]="everySession",e))(Nt||{});const Bt=1e3*60*60*24,Rt=Symbol("SessionService");class Wt{constructor(e){if(new.target===Wt&&e!==Rt)throw new Error(`Invalid ${new.target.name} constructor`)}hasUserVisitedPage(){return this.getSessionVisitData().count>1}saveUserVisit(){const e=this.getSessionVisitData()||{count:0};sessionStorage.setItem("gaUserPageSessionVisit",JSON.stringify({...e,count:e.count+1}))}getSessionVisitData(){return JSON.parse(sessionStorage.getItem("gaUserPageSessionVisit"))}}const $t=new Wt(Rt),jt=Symbol("DebugSessionService");class Ft extends Wt{constructor(e){if(super(),new.target===Ft&&e!==jt)throw new Error(`Invalid ${new.target.name} constructor`)}hasUserVisitedPage(){const e=B(x.HasUserVisitPage);if(void 0===e)return super.hasUserVisitedPage();else return e}setHasUserVisitedPage(e){N(x.HasUserVisitPage,e)}}const Mt=new Ft(jt);function Jt(){return R($t,Mt)}const zt=Symbol("VisitService");class qt{constructor(e){if(new.target===qt&&e!==zt)throw new Error(`Invalid ${new.target.name} constructor`)}async validateFrequencyProperty(e,t=0){if(e===Nt.Session)return!Jt().hasUserVisitedPage();else if(e===Nt.OnceEveryDays){const e=await Ot().getLastActivityDate();if(e)return((e,t)=>{const i=new Date(e+t*Bt),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);return Date.now()>=Date.parse(r.toString())})(e.getTime(),t)}return true}async validateVisitorsProperty(e){const t=await Ot().isNewVisitor();switch(e){case ue.New:return t;case ue.Returning:return!t;default:return true}}validateUrlPath(e="*"){const t=window.location.pathname;return this.validatePath(e,t)}validatePath(e,t){return oe(t,e)}}const Gt=new qt(zt),Ht=Symbol("DebugVisitService");class Kt extends qt{constructor(e){if(super(),new.target===Kt&&e!==Ht)throw new Error(`Invalid ${new.target.name} constructor`)}validateUrlPath(e="*"){const t=B(x.VisitUrlPath);if(void 0===t)return super.validateUrlPath(e);else return super.validatePath(e,t)}setVisitPathUrl(e){if("string"!=typeof e)return S.error("Invalid url path type. Try again with string variable"),null;N(x.VisitUrlPath,e)}}const Xt=new Kt(Ht),Yt=Symbol("DebugDeviceService");class Qt extends it{constructor(e){if(super(),new.target===Qt&&e!==Yt)throw new Error(`Invalid ${new.target.name} constructor`)}getDeviceType(){const e=B(x.DeviceType);if(!e)return super.getDeviceType();if(!Object.values(ce).includes(e))return S.error("Incorrect debug device type. Check if device is correct. Instead of that we will use normal values"),super.getDeviceType();else return e}setDeviceType(e){N(x.DeviceType,e)}}const Zt=new Qt(Yt),ei=Symbol("LocationService");class ti{constructor(e){if(new.target===ti&&e!==ei)throw new Error(`Invalid ${new.target.name} constructor`)}getVisitorCountryCode(){const{domain:e}=window.__grIntegrationConfig.cData;return fetch(`${e}web-user-data/country`).then((e=>e.text()))}}const ii=new ti(ei),ri=Symbol("DebugLocationService");class ni extends ti{constructor(e){if(super(),new.target===ni&&e!==ri)throw new Error(`Invalid ${new.target.name} constructor`)}getVisitorCountryCode(){const e=B(x.Location);if(!e)return super.getVisitorCountryCode();else return Promise.resolve(e)}setVisitorCountryCode(e){if("string"!=typeof e)return S.error("Incorrect debug country code value"),null;N(x.Location,e)}}const si=new ni(ri),oi=[A.OrderPlaced,A.LikeItem,A.UnlikeItem,A.WishlistItem,A.ViewItem,A.ViewCategory];d=new WeakSet,l=()=>{return new URL(`c/${e=Z.getClientLatestGrid(),e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}/e/save/batch/`,Z.webEventsSearchApplicationEndpoint).href;var e};const ai=new class{constructor(){w(this,d)}async addPopupEventToStorage(e){throw new Error("Not implemented")}async getPopupActivityData(e){throw new Error("Not implemented")}async saveEventsToStorage(e){if(Z.webEventsSearchApplicationEndpoint){const t=e.filter((e=>oi.includes(e.event.name)));(class{static sendJSON(e,t,i=true){const r=i?JSON.stringify({...JSON.parse(t),[z.UserAid]:Z.getUserAid()}):t;navigator.sendBeacon(e,new Blob([r],{type:"application/json"}))}}).sendJSON(m(this,d,l).call(this),JSON.stringify(t),false)}else S.warn("Attempt to send web events to search was made without search application endpoint!")}};var ci=(e=>(e["Events"]="gr_webconnect",e["VisitorJourneys"]="gr_visitor_journeys",e["ServiceWorkerCallbacks"]="gr_sw_callbacks",e))(ci||{});const ui={gr_webconnect:1,gr_visitor_journeys:2,gr_sw_callbacks:1};var di=(e=>(e["UserActivityEvents"]="user_activity_events",e))(di||{}),li=(e=>(e["EventType"]="eventType",e["VisitorUuid"]="visitorUuid",e["EventTypeWithVisitor"]="eventType, visitorUuid",e))(li||{});let gi,vi;const pi=new WeakMap,hi=new WeakMap,wi=new WeakMap,mi=new WeakMap,fi=new WeakMap;let yi={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return hi.get(e);if("objectStoreNames"===t)return e.objectStoreNames||wi.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Si(e[t])},set:(e,t,i)=>(e[t]=i,true),has(e,t){if(e instanceof IDBTransaction&&("done"===t||"store"===t))return true;else return t in e}};function bi(e){if("function"==typeof e)return function(e){if(e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype))return function(t,...i){const r=e.call(Ii(this),t,...i);return wi.set(r,t.sort?t.sort():[t]),Si(r)};if((vi||(vi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e))return function(...t){return e.apply(Ii(this),t),Si(pi.get(this))};else return function(...t){return Si(e.apply(Ii(this),t))}}(e);if(e instanceof IDBTransaction)!(e=>{if(hi.has(e))return;const t=new Promise(((t,i)=>{const r=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",s),e.removeEventListener("abort",s)},n=()=>{t(),r()},s=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",n),e.addEventListener("error",s),e.addEventListener("abort",s)}));hi.set(e,t)})(e);if(t=e,(gi||(gi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e)))return new Proxy(e,yi);else return e;var t}function Si(e){if(e instanceof IDBRequest)return(e=>{const t=new Promise(((t,i)=>{const r=()=>{e.removeEventListener("success",n),e.removeEventListener("error",s)},n=()=>{t(Si(e.result)),r()},s=()=>{i(e.error),r()};e.addEventListener("success",n),e.addEventListener("error",s)}));return t.then((t=>{if(t instanceof IDBCursor)pi.set(t,e)})).catch((()=>{})),fi.set(t,e),t})(e);if(mi.has(e))return mi.get(e);const t=bi(e);if(t!==e)mi.set(e,t),fi.set(t,e);return t}const Ii=e=>fi.get(e),Ei=["get","getKey","getAll","getAllKeys","count"],Ci=["put","add","delete","clear"],Di=new Map;function Pi(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(Di.get(t))return Di.get(t);const i=t.replace(/FromIndex$/,""),r=t!==i,n=Ci.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!(n||Ei.includes(i)))return;const s=async function(e,...t){const s=this.transaction(e,n?"readwrite":"readonly");let o=s.store;if(r)o=o.index(t.shift());return(await Promise.all([o[i](...t),n&&s.done]))[0]};return Di.set(t,s),s}var Ti;Ti=yi,void(yi={...Ti,get(e,t,i){return Pi(e,t)||Ti.get(e,t,i)},has(e,t){return!!Pi(e,t)||Ti.has(e,t)}});const Vi=new class{openEventsDatabaseConnection(e){return this.openConnection(ci.Events,ui[ci.Events],e)}openAutomationJourneysDatabaseConnection(e){return this.openConnection(ci.VisitorJourneys,ui[ci.VisitorJourneys],e)}openServiceWorkerCallbacksDatabaseConnection(e){return this.openConnection(ci.ServiceWorkerCallbacks,ui[ci.ServiceWorkerCallbacks],e)}async openConnection(e,t,i){const r=await((e,t,{blocked:i,upgrade:r,blocking:n,terminated:s}={})=>{const o=indexedDB.open(e,t),a=Si(o);if(r)o.addEventListener("upgradeneeded",(e=>{r(Si(o.result),e.oldVersion,e.newVersion,Si(o.transaction),e)}));if(i)o.addEventListener("blocked",(e=>i(e.oldVersion,e.newVersion,e)));return a.then((e=>{if(s)e.addEventListener("close",(()=>s()));if(n)e.addEventListener("versionchange",(e=>n(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a})(e,t,{blocked(e,t,i){S.error(`Connection to old db version: ${t} not closed. Version ${e} not available`,i)},upgrade(e,t,r){S.log(`New db version ${r} detected, upgrading from ${t}`),i(t,r,e)},terminated(){S.log("Closing db connection")},blocking(e,t,i){S.log(`Current connection od db version ${e} is blocking connection to version ${t}.`,i),r.close()}});return r}};Vi.openServiceWorkerCallbacksDatabaseConnection.bind(Vi),Vi.openAutomationJourneysDatabaseConnection.bind(Vi);const _i=Symbol("BrowserEventsStorageService");g=new WeakSet,v=(e,t,i)=>{if(0===e&&1===t)!(e=>{if(!e.objectStoreNames.contains(di.UserActivityEvents))try{const t=e.createObjectStore(di.UserActivityEvents,{keyPath:"id",autoIncrement:true});t.createIndex(li.EventType,"eventType",{unique:false}),t.createIndex(li.VisitorUuid,"uuid",{unique:false}),t.createIndex(li.EventTypeWithVisitor,["eventType","uuid"])}catch(t){S.error("Error while initializing/upgrading database",t)}})(i)};let ki=class e{constructor(t){if(w(this,g),new.target===e&&t!==_i)throw new Error(`Invalid ${new.target.name} constructor`)}async saveEvent(e){const t=e instanceof nt?e.normalize():e;try{const e=(await Vi.openEventsDatabaseConnection(m(this,g,v))).transaction(di.UserActivityEvents,"readwrite"),i=e.objectStore(di.UserActivityEvents),r=await i.add(t);return await e.done,r}catch(i){S.error("Error while saving event to database",i)}}async getEvents(e){const t=I(Ke.visitorUuid);try{const i=(await Vi.openEventsDatabaseConnection(m(this,g,v))).transaction(di.UserActivityEvents,"readwrite"),r=i.objectStore(di.UserActivityEvents).index(li.EventTypeWithVisitor),n=await r.getAll([e,t]);return await i.done,n}catch(i){S.error("Error while reading from database",i)}}async getPopupECommerceEvents(e){const t=I(Ke.visitorUuid),i=(await Vi.openEventsDatabaseConnection(m(this,g,v))).transaction(di.UserActivityEvents,"readwrite").store.index(li.VisitorUuid),r=[];let n=await i.openCursor(IDBKeyRange.only(t));for(;n;){const{value:t}=n;if(e(t))r.push(t);n=await n.continue()}return r}};const Ui=new ki(_i),Ai=Symbol("DebugBrowserEventsStorageService");class Li extends ki{constructor(e){if(super(),new.target===Li&&e!==Ai)throw new Error(`Invalid ${new.target.name} constructor`)}async getPopupECommerceEvents(e){const t=B(x.Events)||[];if(!t.length)return super.getPopupECommerceEvents(e);else return t.filter(e)}async getEvents(e){const t=I(Ke.visitorUuid),i=B(x.Events)||[];if(!i.length)return super.getEvents(e);else return i.filter((({eventType:i,uuid:r})=>i===e&&r===t))}async saveEvent(e){const t=e instanceof nt?e.toJSON():e,i=[...B(x.Events)||[],t];try{const e=JSON.stringify(i);return N(x.Events,i,e),Math.random()}catch(r){S.error(`Can't parse new debug events. Try again.`)}}}const xi=new Li(Ai);function Oi(){return R(Ui,xi)}const Ni={[A.PageVisit]:Vt.getPageVisitEvent,[A.ViewItem]:Vt.getViewItemEvent,[A.WishlistItem]:Vt.getWishlistItemEvent,[A.LikeItem]:Vt.getLikeItemEvent,[A.UnlikeItem]:Vt.getUnlikeItemEvent,[A.ViewCategory]:Vt.getViewCategoryEvent,[A.OrderPlaced]:Vt.getOrderPlacedEvent,[A.Cart]:Vt.getCartUpdateEvent,[A.Popup]:Vt.getPopupEvent},Bi=new class{constructor(){this.events=[]}async push(e,...[t,i]){if(void 0===e.saveToLocal||e.saveToLocal){const r=this.getEvent(t,i);if(r){const t=await Oi().saveEvent(r);if(r.eventId=String(t),Q.saveEvent(r),!e.preventRenotify)Z.eventBus.publish(P.UserEventSaved,r)}else return S.warn(`Invalid event params`,t,i),void 0}if(e.sendToBackend)this.events.push([t,i])}flush(){if(this.events.length&&Z.canUseBackendStorageForEvents){const e=this.events.map((([e,t])=>{const i=this.getEvent(e,t);if(i)return i.normalizeForExternalStorage();else return null})).filter(Boolean);if(e.length)ai.saveEventsToStorage(e)}this.events=[]}getEvent(e,t){const i=Ni[e];try{return"function"==typeof i?i(t):null}catch(r){S.error("Failed to create user event",r)}}},Ri=new class{isScriptDelayed(e){return Object.keys(Z.delayedScripts).includes(e)}delay(e){if(!this.isScriptDelayed(e))Z.delayedScripts={...Z.delayedScripts,[e]:void 0}}storeDelayedScriptParams(e,t){if(this.isScriptDelayed(e))Z.delayedScripts={...Z.delayedScripts,[e]:t}}initScript(e){var t;const i=Z.delayedScripts[e];if(i){Z.delayedScripts=Object.fromEntries(Object.entries(Z.delayedScripts).filter((([t])=>t!==e)));const r=re[e];null==(t=null==window?void 0:window[r])?void 0:t.init(...i)}}};class Wi extends class{setDomain(e){if(!e||"auto"===e)this.cookieDomain=(()=>{const e=new Date,t=location.hostname.split(".").reverse(),i=[],r=`gaDomain-${f(6)}`,n=f(6);let s="";for(e.setTime(e.getTime()+60*1e3),i.push(t.shift());t.length>0;){if(s=i.reverse().join("."),document.cookie=`${r}=${n}; expires=${e.toUTCString()}; domain=.${s}; path=/`,I(r)===n)return s;i.push(t.shift())}return location.hostname})();else this.cookieDomain=e}setListToken(e){this.listToken=e}}{constructor(e,t,i,r){super(),this.cookieDomain="",this.listToken="",this.email="",this.uuid=document.cookie.replace(/(?:(?:^|.*;\s*)gaVisitorUuid\s*\=\s*([^;]*).*$)|^.*$/,"$1")||"",this.valuable=Number(document.cookie.replace(/(?:(?:^|.*;\s*)gaIsValuable\s*\=\s*([^;]*).*$)|^.*$/,"$1")||0),this.gr_x=C("gr_x")||"",this.gr_s=C("gr_s")||"",this.gr_m=C("gr_m")||"",this.tracking=new V,this.wasPageVisitEventSaved=false,this.onEventPush=(...[e,t,i])=>{Bi.push(e,t,i)},this.onEventFlush=()=>{Bi.flush()},this.onImportScript=async(e,...t)=>{if(Object.values(ie).includes(e)){const{webConnectScriptCdnUrl:i,webConnectCurrentScriptsVersion:r}=Z,n=new URL(`${e}.${r}.umd.js`,i);import(n.href).then((()=>{window[re[e]].init(...t)}))}else S.error(`Invalid script name ${e}`)},this.onDomainSet=e=>{this.setDomain(e)},this.onListTokenSet=e=>{this.setListToken(e)},this.onSetUserId=(e,t)=>{if("string"!=typeof e)throw new Error(`User email should be a string`);this.assureDomainIsSet(),this.assureUuidIsSet(),this.setUserId(e,t)},this.onSetEvent=(e,t)=>{this.assureDomainIsSet(),this.assureUuidIsSet(),this.tracking.setUserId(this.serialize()),this.setEvent(e,t)},this.onSetCookie=(e,t)=>{E(e,t,this.cookieDomain)},this.onPush=()=>{this.push()},this.onSetCustomServiceWorkerPath=e=>{Z.setCustomSwPath(e)},this.createDefaultEventsAndSave=()=>{if("hidden"===document.visibilityState){if(!this.wasPageVisitEventSaved)Ot().saveUserActivity(),this.wasPageVisitEventSaved=true;Z.eventBus.publish(D.FlushEvents)}},this.xsid=i||"",this.tracking.setCustomVariable(1,"grid",t),this.tracking.setCustomVariable(2,"aid",r),this.tracking.setTrackerUrl(`${e}index.php?ver=3`),this.tracking.markAsEnabled(Z.isTrackingEnabled()),this.tracking.setUserId(this.serialize())}async initialize(){if(!this.xsid&&!this.valuable&&Z.isTrackingScriptServedFromCustomDomain())this.xsid=await te.retrieveXsid();this.attachListeners()}attachListeners(){const{eventBus:e}=Z;e.subscribe(D.SetDomain,this.onDomainSet),e.subscribe(D.SetListToken,this.onListTokenSet),e.subscribe(D.SetUserId,this.onSetUserId),e.subscribe(D.SetEvent,this.onSetEvent),e.subscribe(D.SetCookie,this.onSetCookie),e.subscribe(D.Push,this.onPush),e.subscribe(D.SetCustomServiceWorkerPath,this.onSetCustomServiceWorkerPath),e.subscribe(D.ImportScript,this.onImportScript),e.subscribe(D.SetVisitUrlPath,this.onSetVisitUrlPath),e.subscribe(D.SetLastActivityDate,this.onSetLastActivityDate),e.subscribe(D.SetIsNewVisitor,this.onSetIsNewVisitor),e.subscribe(D.SetHasUserVisitPage,this.onSetHasUserVisitPage),e.subscribe(D.SetUserDevice,this.onSetDevice),e.subscribe(D.SetUserLocation,this.onSetUserLocation),e.subscribe(D.SetRawEvent,this.onSetRawEvent),e.subscribe(D.SaveEvent,this.onEventPush),e.subscribe(D.FlushEvents,this.onEventFlush),e.subscribe(D.DelayScript,this.onScriptDelay),e.subscribe(D.InitScript,this.onScriptInit)}assureDomainIsSet(){if(!this.cookieDomain)this.onDomainSet("auto")}assureUuidIsSet(){if(!this.uuid){const e=this.generateUuid();window.sessionStorage.setItem(_.UuidHasBeenSet,"true"),this.uuid=e}}setValuability(){if(this.gr_x&&this.gr_s)this.setIsValuable();if(this.email||this.xsid)this.setIsValuable()}assureEventsAreCreatedAndSaved(){document.addEventListener("visibilitychange",this.createDefaultEventsAndSave)}generateUuid(){let e=I("gaVisitorUuid");if(!e)e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),E("gaVisitorUuid",e,this.cookieDomain);return e}setUserId(e,t){if(e&&Z.isTrackingEnabled())Z.visitorEmail=e,this.email=e,this.listToken=t||this.listToken,this.setIsValuable(),this.push()}setEvent(e,t){if(void 0===t)this.tracking.trackEvent("custom","fire",e);else this.tracking.trackEvent("custom","fire",e,JSON.stringify(t))}push(){this.tracking.setUserId(this.serialize()),this.tracking.trackPageView()}setIsValuable(){if(Z.isTrackingEnabled())this.valuable=1,E("gaIsValuable","1",this.cookieDomain)}serialize(){return JSON.stringify({uuid:this.uuid,email:this.email,xsid:this.xsid,list_token:this.listToken,gr_x:this.gr_x,gr_s:this.gr_s,gr_m:this.gr_m,valuable:this.valuable,domain:this.cookieDomain})}onSetVisitUrlPath(e){const t=R(Gt,Xt);if(t instanceof Kt)t.setVisitPathUrl(e)}onSetLastActivityDate(e){const t=Ot();if(t instanceof Lt)t.setLastActivityDate(e)}onSetIsNewVisitor(e){const t=Ot();if(t instanceof Lt)t.setIsNewVisitor(e)}onSetHasUserVisitPage(e){const t=Jt();if(t instanceof Ft)t.setHasUserVisitedPage(e)}onSetDevice(e){const t=R(rt,Zt);if(t instanceof Qt)t.setDeviceType(e)}onSetUserLocation(e){const t=R(ii,si);if(t instanceof ni)t.setVisitorCountryCode(e)}onSetRawEvent(e){const t=Oi();if(t instanceof Li)t.saveEvent(e)}onScriptDelay(e){Ri.delay(e)}onScriptInit(e){Ri.initScript(e)}}e.init=e=>{const t=JSON.parse(e),{grid:i,clientLatestGrid:r,aid:n,xsid:s,isServedFromCustomDomain:o,scriptVersion:a,scriptDomain:c,useBackendSubscriberIdentification:u,useBackendStorage:d,trackingUrl:l,tracking:g,isDebugMode:v}=t,p=window["__GetResponseAnalyticsObject"]||"GrTracking";(()=>{if([Array.from,"".endsWith,"".startsWith,[].entries].some((e=>!e.toString().includes("[native code]"))))S.warn("Modification of native JavaScript object/methods detected, WebConnect might not work correctly!")})(),Z.initialize({xsid:s,aid:n,grid:i,clientLatestGrid:r,domain:l,useNOStorage:"true"===d,useBetterSubscriberIdentification:"true"===u,isServedFromCustomDomain:"true"===o,scriptsDomain:c,scriptsVersion:a,tracking:"true"===g,isDebugMode:"true"===v});const h=new Wi(l,i,s,n);function w(e,t){window[p](e,t)}h.initialize().then((()=>{var e;if(Array.isArray(null==(e=window[p])?void 0:e.q))window[p].q.forEach(((e,t)=>{if("push"!==e[0])Z.eventBus.publish(e[0],e[1],e[2]),delete window[p].q[t]}));window[p]=(e,t,i)=>{Z.eventBus.publish(e,t,i)},h.assureDomainIsSet(),h.assureUuidIsSet(),h.setValuability(),Z.eventBus.publish(D.Push),h.assureEventsAreCreatedAndSaved()})),window.gaSetUserId=e=>{w(D.SetUserId,e)},window.gaPush=()=>{w(D.Push)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}((e="undefined"!=typeof globalThis?globalThis:e||self).GRV2={})}(this);
